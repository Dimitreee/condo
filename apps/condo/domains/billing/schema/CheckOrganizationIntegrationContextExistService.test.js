/**
 * Generated by `createservice billing.CheckOrganizationIntegrationContextExistService --type queries`
 */

const { createTestOrganization } = require('@condo/domains/organization/utils/testSchema')
const { makeLoggedInClient } = require('@core/keystone/test.utils')
const { makeContextWithOrganizationAndIntegrationAsAdmin } = require('../utils/testSchema')
const { expectToThrowAuthenticationErrorToObjects } = require('@condo/domains/common/utils/testSchema')
const { makeClient } = require('@core/keystone/test.utils')

const { checkOrganizationIntegrationContextExistByTestClient } = require('@condo/domains/billing/utils/testSchema')
 
describe('CheckOrganizationIntegrationContextExistService', () => {
    test('user get isFound: true execute with existing organization', async () => {
        const client = await makeLoggedInClient()

        const organization = await createTestOrganization(client)

        const payload = {
            organizationId: organization.id,
        }
        const [data] = await checkOrganizationIntegrationContextExistByTestClient(client, payload)

        expect(data.isFound).toEqual(false)
    })

    test('user get isFound: false when execute without existing organization', async () => {
        const client = await makeLoggedInClient()

        const { organization } = await makeContextWithOrganizationAndIntegrationAsAdmin()

        const payload = {
            organizationId: organization.id,
        }
        const [data] = await checkOrganizationIntegrationContextExistByTestClient(client, payload)

        expect(data.isFound).toEqual(true)
    })

    test('anonymous cant execute query', async () => {
        const client = await makeClient()
        await expectToThrowAuthenticationErrorToObjects(async () => {
            await checkOrganizationIntegrationContextExistByTestClient(client)
        })
    })
})
/**
 * Generated by `createservice notification.RegisterPushTokenService --type mutations`
 */

const isEmpty = require('lodash/isEmpty')

const { PUSH_TOKEN_OPERATIONS } = require('../constants')

async function canRegisterPushToken (args) {
    const { args: { data }, context: { authedItem }, ...rest } = args
    // Anyone, including anonymous users, can register push tokens

    // Token is required for register operation
    if (data.operation === PUSH_TOKEN_OPERATIONS.register && isEmpty(data.token)) return false

    // logged in user is required for connect operation
    if (data.operation === PUSH_TOKEN_OPERATIONS.connect && isEmpty(authedItem)) return false

    return true
}

/*
  Rules are logical functions that used for list access, and may return a boolean (meaning
  all or no items are available) or a set of filters that limit the available items.
*/
module.exports = {
    canRegisterPushToken,
}
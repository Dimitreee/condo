// auto generated by kmigrator
// KMIGRATOR:0130_ticketchange_filesdisplaynamesfrom_and_more:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDQuMC40IG9uIDIwMjItMDUtMTIgMTI6NTgKCmZyb20gZGphbmdvLmRiIGltcG9ydCBtaWdyYXRpb25zLCBtb2RlbHMKaW1wb3J0IGRqYW5nby5kYi5tb2RlbHMuZGVsZXRpb24KCgpjbGFzcyBNaWdyYXRpb24obWlncmF0aW9ucy5NaWdyYXRpb24pOgoKICAgIGRlcGVuZGVuY2llcyA9IFsKICAgICAgICAoJ19kamFuZ29fc2NoZW1hJywgJzAxMjlfYjJiYXBwX2IyYmFwcGFjY2Vzc3JpZ2h0aGlzdG9yeXJlY29yZF9hbmRfbW9yZScpLAogICAgXQoKICAgIG9wZXJhdGlvbnMgPSBbCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0ndGlja2V0Y2hhbmdlJywKICAgICAgICAgICAgbmFtZT0nZmlsZXNEaXNwbGF5TmFtZXNGcm9tJywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLkpTT05GaWVsZChkZWZhdWx0PXt9KSwKICAgICAgICAgICAgcHJlc2VydmVfZGVmYXVsdD1GYWxzZSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J3RpY2tldGNoYW5nZScsCiAgICAgICAgICAgIG5hbWU9J2ZpbGVzRGlzcGxheU5hbWVzVG8nLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuSlNPTkZpZWxkKGRlZmF1bHQ9e30pLAogICAgICAgICAgICBwcmVzZXJ2ZV9kZWZhdWx0PUZhbHNlLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5BZGRGaWVsZCgKICAgICAgICAgICAgbW9kZWxfbmFtZT0ndGlja2V0Y2hhbmdlJywKICAgICAgICAgICAgbmFtZT0nZmlsZXNJZHNGcm9tJywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLkpTT05GaWVsZChkZWZhdWx0PXt9KSwKICAgICAgICAgICAgcHJlc2VydmVfZGVmYXVsdD1GYWxzZSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J3RpY2tldGNoYW5nZScsCiAgICAgICAgICAgIG5hbWU9J2ZpbGVzSWRzVG8nLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuSlNPTkZpZWxkKGRlZmF1bHQ9e30pLAogICAgICAgICAgICBwcmVzZXJ2ZV9kZWZhdWx0PUZhbHNlLAogICAgICAgICksCiAgICAgICAgbWlncmF0aW9ucy5DcmVhdGVNb2RlbCgKICAgICAgICAgICAgbmFtZT0ndGlja2V0X2ZpbGVzX21hbnknLAogICAgICAgICAgICBmaWVsZHM9WwogICAgICAgICAgICAgICAgKCdpZCcsIG1vZGVscy5BdXRvRmllbGQoYXV0b19jcmVhdGVkPVRydWUsIHByaW1hcnlfa2V5PVRydWUsIHNlcmlhbGl6ZT1GYWxzZSwgdmVyYm9zZV9uYW1lPSdJRCcpKSwKICAgICAgICAgICAgICAgICgnVGlja2V0RmlsZV9yaWdodF9pZCcsIG1vZGVscy5Gb3JlaWduS2V5KGRiX2NvbHVtbj0nVGlja2V0RmlsZV9yaWdodF9pZCcsIG9uX2RlbGV0ZT1kamFuZ28uZGIubW9kZWxzLmRlbGV0aW9uLkNBU0NBREUsIHJlbGF0ZWRfbmFtZT0nKycsIHRvPSdfZGphbmdvX3NjaGVtYS50aWNrZXRmaWxlJykpLAogICAgICAgICAgICAgICAgKCdUaWNrZXRfbGVmdF9pZCcsIG1vZGVscy5Gb3JlaWduS2V5KGRiX2NvbHVtbj0nVGlja2V0X2xlZnRfaWQnLCBvbl9kZWxldGU9ZGphbmdvLmRiLm1vZGVscy5kZWxldGlvbi5DQVNDQURFLCByZWxhdGVkX25hbWU9JysnLCB0bz0nX2RqYW5nb19zY2hlbWEudGlja2V0JykpLAogICAgICAgICAgICBdLAogICAgICAgICAgICBvcHRpb25zPXsKICAgICAgICAgICAgICAgICdkYl90YWJsZSc6ICdUaWNrZXRfZmlsZXNfbWFueScsCiAgICAgICAgICAgIH0sCiAgICAgICAgKSwKICAgIF0K

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Add field filesDisplayNamesFrom to ticketchange
--
ALTER TABLE "TicketChange" ADD COLUMN "filesDisplayNamesFrom" jsonb DEFAULT '{}' NOT NULL;
ALTER TABLE "TicketChange" ALTER COLUMN "filesDisplayNamesFrom" DROP DEFAULT;
--
-- Add field filesDisplayNamesTo to ticketchange
--
ALTER TABLE "TicketChange" ADD COLUMN "filesDisplayNamesTo" jsonb DEFAULT '{}' NOT NULL;
ALTER TABLE "TicketChange" ALTER COLUMN "filesDisplayNamesTo" DROP DEFAULT;
--
-- Add field filesIdsFrom to ticketchange
--
ALTER TABLE "TicketChange" ADD COLUMN "filesIdsFrom" jsonb DEFAULT '{}' NOT NULL;
ALTER TABLE "TicketChange" ALTER COLUMN "filesIdsFrom" DROP DEFAULT;
--
-- Add field filesIdsTo to ticketchange
--
ALTER TABLE "TicketChange" ADD COLUMN "filesIdsTo" jsonb DEFAULT '{}' NOT NULL;
ALTER TABLE "TicketChange" ALTER COLUMN "filesIdsTo" DROP DEFAULT;
--
-- Create model ticket_files_many
--
CREATE TABLE "Ticket_files_many" ("id" serial NOT NULL PRIMARY KEY, "TicketFile_right_id" uuid NOT NULL, "Ticket_left_id" uuid NOT NULL);
ALTER TABLE "Ticket_files_many" ADD CONSTRAINT "Ticket_files_many_TicketFile_right_id_3718b3cb_fk_TicketFile_id" FOREIGN KEY ("TicketFile_right_id") REFERENCES "TicketFile" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "Ticket_files_many" ADD CONSTRAINT "Ticket_files_many_Ticket_left_id_350b16ca_fk_Ticket_id" FOREIGN KEY ("Ticket_left_id") REFERENCES "Ticket" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "Ticket_files_many_TicketFile_right_id_3718b3cb" ON "Ticket_files_many" ("TicketFile_right_id");
CREATE INDEX "Ticket_files_many_Ticket_left_id_350b16ca" ON "Ticket_files_many" ("Ticket_left_id");
COMMIT;

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Create model ticket_files_many
--
DROP TABLE "Ticket_files_many" CASCADE;
--
-- Add field filesIdsTo to ticketchange
--
ALTER TABLE "TicketChange" DROP COLUMN "filesIdsTo" CASCADE;
--
-- Add field filesIdsFrom to ticketchange
--
ALTER TABLE "TicketChange" DROP COLUMN "filesIdsFrom" CASCADE;
--
-- Add field filesDisplayNamesTo to ticketchange
--
ALTER TABLE "TicketChange" DROP COLUMN "filesDisplayNamesTo" CASCADE;
--
-- Add field filesDisplayNamesFrom to ticketchange
--
ALTER TABLE "TicketChange" DROP COLUMN "filesDisplayNamesFrom" CASCADE;
COMMIT;

    `)
}
